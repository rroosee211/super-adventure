mixed-port: 7890
allow-lan: true
mode: rule
log-level: silent
external-controller: 0.0.0.0:9090
ipv6: true
disable-keep-alive: false
keep-alive-idle: 300  # 最长保活300秒

listeners:
  - name: ss-in
    type: shadowsocks
    port: 8491
    listen: 0.0.0.0
    cipher: none
    password: 123
    udp: true

proxies: []

proxy-groups:
  - name: Proxy
    type: select
    proxies: [Hash, Round, Auto, Manual, DIRECT]
  - name: Manual
    type: select
    use: [provider1, provider2]
  - name: Direct
    type: select
    proxies: [DIRECT, Proxy]
  - name: Fish
    type: select
    proxies: [Proxy, DIRECT]
  - name: Hash
    type: load-balance
    strategy: consistent-hashing
    use: [provider1, provider2]
  - name: Round
    type: load-balance
    strategy: round-robin
    use: [provider1, provider2]
  - name: Auto
    type: url-test
    use: [provider1, provider2]

p: &p
  type: http
  interval: 86400
  exclude-filter: "韩"
  health-check:
    enable: true
    url: "https://www.gstatic.com/generate_204"
    interval: 600

proxy-providers:
  provider1:
    <<: *p
    url: ""
    path: ./proxy_providers/provider1.yaml
  provider2:
    <<: *p
    url: ""
    path: ./proxy_providers/provider2.yaml
  provider3:
    <<: *p
    url: ""
    path: ./proxy_providers/provider3.yaml

dns:
  enable: true
  ipv6: true
  enhanced-mode: fake-ip
  fake-ip-range: '198.18.0.1/16'
  default-nameserver: ['https://223.5.5.5/dns-query']
  nameserver: ['https://doh.pub/dns-query','https://dns.alidns.com/dns-query']
  proxy-server-nameserver: ['https://dns.cloudflare.com/dns-query#DIRECT','https://doh.opendns.com/dns-query#DIRECT']
  fake-ip-filter: ['+.msftncsi.com','+.msftconnecttest.com','*.time.edu.cn','ntp.*.com','ntp.ntsc.ac.cn','geosite:cn','rule-set:direct']
  unified-delay: true
  tcp-concurrent: true

profile:
  store-fake-ip: true
  store-selected: true

geodata-mode: true
geodata-loader: standard
geo-auto-update: true
geo-update-interval: 72
geox-url:
  geoip: "https://cdn.jsdmirror.com/gh/MetaCubeX/meta-rules-dat@release/geoip.dat"
  geosite: "https://cdn.jsdmirror.com/gh/MetaCubeX/meta-rules-dat@release/geosite.dat"
  mmdb: "https://cdn.jsdmirror.com/gh/MetaCubeX/meta-rules-dat@release/country.mmdb"

pr: &pr
  type: http
  interval: 86400
  behavior: domain

rule-providers:
  proxy:
    <<: *pr
    url: "https://cdn.jsdmirror.com/gh/Loyalsoldier/clash-rules@release/proxy.txt"
    path: ./ruleset/proxy.yaml
  direct:
    <<: *pr
    url: "https://cdn.jsdmirror.com/gh/Loyalsoldier/clash-rules@release/direct.txt"
    path: ./ruleset/direct.yaml
  reject_non_ip:
    <<: *pr
    behavior: classical
    format: text
    url: "https://ruleset.skk.moe/Clash/non_ip/reject.txt"
    path: ./sukkaw_ruleset/reject_non_ip.txt
  reject_domainset:
    <<: *pr
    format: text
    url: "https://ruleset.skk.moe/Clash/domainset/reject.txt"
    path: ./sukkaw_ruleset/reject_domainset.txt
  reject_phishing_domainset:
    <<: *pr
    format: text
    url: "https://ruleset.skk.moe/Clash/domainset/reject_phishing.txt"
    path: ./sukkaw_ruleset/reject_phishing_domainset.txt
  reject_ip:
    <<: *pr
    behavior: classical
    format: text
    url: "https://ruleset.skk.moe/Clash/ip/reject.txt"
    path: ./sukkaw_ruleset/reject_ip.txt

rules:
  - RULE-SET,reject_non_ip,REJECT,no-resolve
  - RULE-SET,reject_domainset,REJECT,no-resolve
  - RULE-SET,reject_phishing_domainset,REJECT,no-resolve
  - RULE-SET,reject_ip,REJECT,no-resolve
  - GEOSITE,category-ads-all,REJECT,no-resolve
  - GEOSITE,github,Proxy,no-resolve
  - OR,((DST-PORT,9993,no-resolve),(SRC-PORT,9993,no-resolve)),DIRECT
  - GEOSITE,cn,Direct,no-resolve
  - GEOIP,CN,Direct,no-resolve
  - RULE-SET,direct,Direct,no-resolve
  - IP-CIDR,192.168.0.0/16,DIRECT,no-resolve
  - RULE-SET,proxy,Proxy,no-resolve
  - MATCH,Fish,no-resolve
